{% comment %}
  Sección de Contador Regresivo
{% endcomment %}

<section class="px-4 py-16 mx-auto max-w-7xl" style="background-color: {{ section.settings.background_color }};">
  <div class="max-w-4xl mx-auto text-center">
    {% if section.settings.heading != blank %}
      <h2 class="mb-4" style="color: {{ section.settings.text_color }};">{{ section.settings.heading }}</h2>
    {% endif %}
    
    {% if section.settings.subheading != blank %}
      <p class="mb-8" style="color: {{ section.settings.text_color }};">{{ section.settings.subheading }}</p>
    {% endif %}

    <div class="flex justify-center gap-4 mb-8">
      <div class="flex flex-col items-center justify-center w-24 h-24 border-2 rounded-lg" style="border-color: {{ section.settings.text_color }};">
        <span class="countdown-days text-3xl" style="color: {{ section.settings.text_color }};">00</span>
        <span class="text-sm" style="color: {{ section.settings.text_color }};">Días</span>
      </div>
      <div class="flex flex-col items-center justify-center w-24 h-24 border-2 rounded-lg" style="border-color: {{ section.settings.text_color }};">
        <span class="countdown-hours text-3xl" style="color: {{ section.settings.text_color }};">00</span>
        <span class="text-sm" style="color: {{ section.settings.text_color }};">Horas</span>
      </div>
      <div class="flex flex-col items-center justify-center w-24 h-24 border-2 rounded-lg" style="border-color: {{ section.settings.text_color }};">
        <span class="countdown-minutes text-3xl" style="color: {{ section.settings.text_color }};">00</span>
        <span class="text-sm" style="color: {{ section.settings.text_color }};">Minutos</span>
      </div>
      <div class="flex flex-col items-center justify-center w-24 h-24 border-2 rounded-lg" style="border-color: {{ section.settings.text_color }};">
        <span class="countdown-seconds text-3xl" style="color: {{ section.settings.text_color }};">00</span>
        <span class="text-sm" style="color: {{ section.settings.text_color }};">Segundos</span>
      </div>
    </div>

    {% if section.settings.button_text != blank %}
      <a 
        href="{{ section.settings.button_link }}" 
        class="inline-block px-6 py-3 text-white transition-colors bg-black rounded-lg hover:bg-neutral-800"
        style="background-color: {{ section.settings.button_color }};"
      >
        {{ section.settings.button_text }}
      </a>
    {% endif %}
  </div>
</section>

<script>
  (function() {
    const endDate = new Date("{{ section.settings.end_date }}").getTime();
    
    function updateCountdown() {
      const now = new Date().getTime();
      const distance = endDate - now;
      
      if (distance < 0) {
        document.querySelectorAll('.countdown-days, .countdown-hours, .countdown-minutes, .countdown-seconds').forEach(el => {
          el.textContent = '00';
        });
        return;
      }
      
      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((distance % (1000 * 60)) / 1000);
      
      const daysEl = document.querySelector('.countdown-days');
      const hoursEl = document.querySelector('.countdown-hours');
      const minutesEl = document.querySelector('.countdown-minutes');
      const secondsEl = document.querySelector('.countdown-seconds');
      
      if (daysEl) daysEl.textContent = String(days).padStart(2, '0');
      if (hoursEl) hoursEl.textContent = String(hours).padStart(2, '0');
      if (minutesEl) minutesEl.textContent = String(minutes).padStart(2, '0');
      if (secondsEl) secondsEl.textContent = String(seconds).padStart(2, '0');
    }
    
    updateCountdown();
    setInterval(updateCountdown, 1000);
  })();
</script>

{% schema %}
{
  "name": "Contador Regresivo",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Título",
      "default": "Oferta por Tiempo Limitado"
    },
    {
      "type": "text",
      "id": "subheading",
      "label": "Subtítulo",
      "default": "¡Apúrate! La oferta termina pronto"
    },
    {
      "type": "text",
      "id": "end_date",
      "label": "Fecha de finalización",
      "info": "Formato: YYYY-MM-DD HH:MM:SS (ej: 2025-12-31 23:59:59)",
      "default": "2025-12-31 23:59:59"
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Texto del botón",
      "default": "Comprar Ahora"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "Enlace del botón"
    },
    {
      "type": "color",
      "id": "background_color",
      "label": "Color de fondo",
      "default": "#000000"
    },
    {
      "type": "color",
      "id": "text_color",
      "label": "Color de texto",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "button_color",
      "label": "Color del botón",
      "default": "#ffffff"
    }
  ],
  "presets": [
    {
      "name": "Contador Regresivo"
    }
  ]
}
{% endschema %}
