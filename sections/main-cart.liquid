{% comment %}
  Sección Principal de Carrito
{% endcomment %}

<div class="px-4 py-16 mx-auto max-w-7xl">
  <h1 class="mb-8">Carrito de Compras</h1>

  {% if cart.item_count > 0 %}
    <form action="{{ routes.cart_url }}" method="post" novalidate class="grid gap-8 lg:grid-cols-3">
      <div class="lg:col-span-2">
        <div class="space-y-4">
          {% for item in cart.items %}
            <div class="flex gap-4 p-4 border rounded-lg border-neutral-200">
              <div class="w-24 h-24 overflow-hidden rounded-lg bg-neutral-50 shrink-0">
                {% if item.image %}
                  <img 
                    src="{{ item.image | img_url: '200x200' }}" 
                    alt="{{ item.title | escape }}"
                    class="object-cover w-full h-full"
                  >
                {% endif %}
              </div>
              
              <div class="flex flex-col flex-1 min-w-0">
                <h3 class="mb-1">
                  <a href="{{ item.url }}" class="hover:underline">
                    {{ item.product.title }}
                  </a>
                </h3>
                
                {% if item.variant.title != 'Default Title' %}
                  <p class="mb-2 text-neutral-600">{{ item.variant.title }}</p>
                {% endif %}
                
                <p class="mb-4 text-neutral-900">
                  {{ item.final_price | money }}
                </p>
                
                <div class="flex items-center gap-4 mt-auto">
                  <div class="flex items-center gap-2 border rounded-lg border-neutral-300">
                    <button 
                      type="button" 
                      class="p-2 transition-colors hover:bg-neutral-100"
                      onclick="updateQuantity({{ item.index }}, {{ item.quantity | minus: 1 }})"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 12H4"></path>
                      </svg>
                    </button>
                    
                    <input 
                      type="number" 
                      name="updates[]" 
                      id="updates_{{ item.key }}" 
                      value="{{ item.quantity }}" 
                      min="0"
                      class="w-12 text-center border-0"
                      onchange="this.form.submit()"
                    >
                    
                    <button 
                      type="button" 
                      class="p-2 transition-colors hover:bg-neutral-100"
                      onclick="updateQuantity({{ item.index }}, {{ item.quantity | plus: 1 }})"
                    >
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                      </svg>
                    </button>
                  </div>
                  
                  <a 
                    href="{{ routes.cart_change_url }}?line={{ item.index }}&quantity=0" 
                    class="p-2 ml-auto transition-colors rounded hover:bg-red-50"
                  >
                    <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      </div>

      <div class="lg:col-span-1">
        <div class="p-6 border rounded-lg border-neutral-200 bg-neutral-50">
          <h2 class="mb-6">Resumen del Pedido</h2>
          
          <div class="space-y-3 mb-6">
            <div class="flex justify-between">
              <span class="text-neutral-600">Subtotal</span>
              <span>{{ cart.total_price | money }}</span>
            </div>
            
            <div class="flex justify-between">
              <span class="text-neutral-600">Envío</span>
              <span class="text-neutral-600">Calculado en checkout</span>
            </div>
            
            <div class="pt-3 border-t border-neutral-300">
              <div class="flex justify-between">
                <span>Total</span>
                <span>{{ cart.total_price | money }}</span>
              </div>
            </div>
          </div>
          
          <button 
            type="submit" 
            name="checkout"
            class="w-full px-6 py-3 text-white transition-colors bg-black rounded-lg hover:bg-neutral-800"
          >
            Proceder al Pago
          </button>
          
          <a 
            href="{{ routes.all_products_collection_url }}" 
            class="block mt-4 text-center text-neutral-600 hover:text-neutral-900"
          >
            Continuar Comprando
          </a>
        </div>
      </div>
    </form>
  {% else %}
    <div class="py-16 text-center">
      <svg class="w-16 h-16 mx-auto mb-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
      </svg>
      <h2 class="mb-4">Tu carrito está vacío</h2>
      <p class="mb-8 text-neutral-600">Agrega productos para comenzar tu compra</p>
      <a 
        href="{{ routes.all_products_collection_url }}" 
        class="inline-block px-6 py-3 text-white bg-black rounded-lg hover:bg-neutral-800"
      >
        Ver Productos
      </a>
    </div>
  {% endif %}
</div>

<script>
  function updateQuantity(line, quantity) {
    fetch('/cart/change.js', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        line: line,
        quantity: quantity
      })
    })
    .then(response => response.json())
    .then(data => {
      location.reload();
    });
  }
</script>

{% schema %}
{
  "name": "Main Cart",
  "settings": [],
  "presets": [
    {
      "name": "Main Cart"
    }
  ]
}
{% endschema %}
